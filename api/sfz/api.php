<?php
//***用法1：?url=http://star.longzhu.com/152364
//***用法2：?id=152364
//***本解析只能解析当前正在直播的视频，无法解析已经下直播的房间
error_reporting(0);header("Content-type:text/html;charset=utf-8");function CURL($url) {$ch = curl_init();curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE);curl_setopt($ch, CURLOPT_HEADER, false);curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);curl_setopt($ch, CURLOPT_URL, $url);curl_setopt($ch, CURLOPT_REFERER, $url);curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);$result = curl_exec($ch);curl_close($ch);return $result;}if($_GET['id']){$durl = CURL('http://star.longzhu.com/'.$_GET['id']);preg_match('/"RoomId":([0-9]+),/imsU',$durl,$id);}elseif($_GET['url']){$durl = CURL($_GET['url']);preg_match('/"RoomId":([0-9]+),/imsU',$durl,$id);}else{exit("参数错误！");}$curl = CURL('http://livestream.plu.cn/live/getlivePlayurl?roomId='.$id[1]);$aurl = CURL('http://liveapi.plu.cn/liveapp/roomstatus?roomId='.$id[1]);$json = json_decode($curl);$ason = json_decode($aurl);$data['poster'] = $ason->cover;$qxd = array('流畅','标清','高清','超清','蓝光','4K');$urls = $json->playLines[0]->urls;foreach($urls as $k => $v){if(is_mobile()===true){if($v->ext=='m3u8'){if($v)$i++;$video[0] = $v->securityUrl;$video[1] = 'video/m3u8';$videos[] = $video;}}else{if($v->ext=='flv'){if($v)$i++;$video[0] = $v->securityUrl;$video[1] = 'video/flv';$video[2] = $qxd[$v->rateLevel];$video[3] = $v->rateLevel;$videos[] = $video;}}}$data['live'] = true;$data['video'] = $videos;echo json_encode($data);function is_mobile() {if (isset($_SERVER['HTTP_X_WAP_PROFILE'])) {return true;}if (isset($_SERVER['HTTP_VIA'])) {return stristr($_SERVER['HTTP_VIA'], "wap") ? true : false;}if (isset($_SERVER['HTTP_USER_AGENT'])) {$clientkeywords = array('nokia','sony','ericsson','mot','samsung','htc','sgh','lg','sharp','sie-','philips','panasonic','alcatel','lenovo','iphone','ipod','blackberry','meizu','android','netfront','symbian','ucweb','windowsce','palm','operamini','operamobi','openwave','nexusone','cldc','midp','wap','mobile');if (preg_match("/(" . implode('|', $clientkeywords) . ")/i", strtolower($_SERVER['HTTP_USER_AGENT']))) {return true;}}if (isset($_SERVER['HTTP_ACCEPT'])) {if ((strpos($_SERVER['HTTP_ACCEPT'], 'vnd.wap.wml') !== false) && (strpos($_SERVER['HTTP_ACCEPT'], 'text/html') === false || (strpos($_SERVER['HTTP_ACCEPT'], 'vnd.wap.wml') < strpos($_SERVER['HTTP_ACCEPT'], 'text/html')))) {return true;}}return false;}?>